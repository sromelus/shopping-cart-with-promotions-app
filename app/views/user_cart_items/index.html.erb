<div class="dashboard-container">
  <!-- Header with cart info and navigation -->
  <header class="dashboard-header">
    <div class="user-welcome">
      <i class="cart-icon">üõí</i>
      <h1><%= current_user.name %>'s Cart</h1>
      <span class="cart-count-header"><%= current_user_cart.cart_items.count %> items</span>
    </div>
    <div class="cart-navigation">
      <%= link_to root_path, class: "back-link" do %>
        <i class="back-icon">‚Üê</i>
        <span>Back to Browse</span>
      <% end %>
    </div>
  </header>

  <!-- Cart Summary Widget -->
  <div class="cart-summary-widget">
    <div class="total-summary">
      <h3>Cart Total</h3>
      <div class="total-price">$<%= current_user_cart.cart_items.sum { |item| item.promotional_total || item.total } %></div>
    </div>
  </div>

  <!-- Main content -->
  <main class="main-content">
    <section class="cart-section">
      <h2 class="section-title">Your Cart Items</h2>
      <p class="section-subtitle">Review and update your selected items</p>

      <div class="cart-items-grid">
        <% @cart_items.each do |cart_item| %>
          <div class="cart-item-card">
            <div class="item-header">
              <h3 class="item-name"><%= cart_item.item.name %></h3>
              <% if cart_item.promotional_total %>
                <div class="discount-badge">SALE</div>
              <% end %>
            </div>
            
            <div class="item-meta">
              <div class="meta-item">
                <i class="meta-icon">üè∑Ô∏è</i>
                <span class="meta-label">Brand:</span>
                <span class="meta-value"><%= cart_item.item.brand&.name %></span>
              </div>

              <div class="meta-item">
                <i class="meta-icon">üìÅ</i>
                <span class="meta-label">Category:</span>
                <span class="meta-value"><%= cart_item.item.category&.name %></span>
              </div>

              <div class="meta-item">
                <span class="meta-label">Sold by:</span>
                <span class="meta-value"><%= cart_item.item.sold_by %></span>
              </div>

              <% if cart_item.item.unit_weight && cart_item.item.unit_weight_label %>
                <div class="meta-item">
                  <span class="meta-label">Unit:</span>
                  <span class="meta-value"><%= cart_item.item.unit_weight %> <%= cart_item.item.unit_weight_label&.humanize %></span>
                </div>
              <% end %>
            </div>

            <!-- Quantity/Weight Section -->
            <div class="quantity-section">
              <label class="quantity-label">
                <%= cart_item.item.quantity? ? "Quantity" : "Weight" %>:
              </label>
              <%= form_with url: user_cart_item_path(cart_item), method: :patch, class: "quantity-form" do %>
                <%= hidden_field_tag :item_id, cart_item.id %>
                <div class="quantity-controls">
                  <% if cart_item.item.quantity? %>
                    <%= number_field_tag :quantity, cart_item.quantity, min: 1, max: 20, class: "quantity-input" %>
                  <% else %>
                    <%= number_field_tag :quantity, cart_item.quantity, min: 0, step: 0.1, class: "quantity-input" %>
                  <% end %>
                  <%= submit_tag "Update", class: "update-btn" %>
                </div>
              <% end %>
            </div>

            <!-- Price Section -->
            <div class="price-section">
              <% if cart_item.promotional_total %>
                <div class="pricing-with-discount">
                  <div class="current-price">$<%= number_with_precision(cart_item.promotional_total, precision: 2) %></div>
                  <div class="original-price">$<%= number_with_precision(cart_item.total, precision: 2) %></div>
                  <div class="unit-price">Unit: $<%= number_with_precision(cart_item.item.price, precision: 2) %></div>
                </div>
                <% if cart_item.item.promotion %>
                  <div class="promotion-info">
                    <%= cart_item.item.discount_amount %>% <%= cart_item.item.promotion&.discount_type_text.humanize %>
                  </div>
                <% end %>
              <% else %>
                <div class="current-price">$<%= number_with_precision(cart_item.total, precision: 2) %></div>
              <% end %>
            </div>

            <!-- Actions -->
            <div class="item-actions">
              <%= form_with url: user_cart_item_path(cart_item), method: :delete, class: "remove-form" do %>
                <%= hidden_field_tag :id, cart_item.id %>
                <%= submit_tag "üóëÔ∏è Remove", class: "remove-btn" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </section>
  </main>
</div>